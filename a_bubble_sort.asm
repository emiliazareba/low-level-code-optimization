section .data
    msg db "Czas sortowania: ", 0
    msg_len equ $ - msg
    newline db 10

    array dd 41, 24, 50, 6, 58, 48, 87, 94, 93, 26
           dd 20, 39, 72, 29, 4, 65, 40, 46, 75, 53
           dd 22, 86, 82, 12, 74, 72, 88, 43, 60, 84
           dd 18, 18, 76, 98, 60, 75, 75, 5, 59, 38
           dd 60, 33, 91, 15, 36, 47, 75, 36, 9, 69
           dd 68, 11, 31, 87, 48, 63, 95, 38, 31, 5
           dd 68, 17, 88, 17, 82, 40, 98, 19, 70, 21
           dd 26, 94, 28, 63, 59, 26, 9, 22, 23, 26
           dd 7, 37, 78, 8, 27, 9, 64, 6, 27, 94
           dd 35, 27, 68, 5, 41, 37, 19, 10, 14, 97
           dd 41, 24, 50, 6, 58, 48, 87, 94, 93, 26
           dd 20, 39, 72, 29, 4, 65, 40, 46, 75, 53
           dd 22, 86, 82, 12, 74, 72, 88, 43, 60, 84
           dd 18, 18, 76, 98, 60, 75, 75, 5, 59, 38
           dd 60, 33, 91, 15, 36, 47, 75, 36, 9, 69
           dd 68, 11, 31, 87, 48, 63, 95, 38, 31, 5
           dd 68, 17, 88, 17, 82, 40, 98, 19, 70, 21
           dd 26, 94, 28, 63, 59, 26, 9, 22, 23, 26
           dd 7, 37, 78, 8, 27, 9, 64, 6, 27, 94
           dd 35, 27, 68, 5, 41, 37, 19, 10, 14, 97
           dd 41, 24, 50, 6, 58, 48, 87, 94, 93, 26
           dd 20, 39, 72, 29, 4, 65, 40, 46, 75, 53
           dd 22, 86, 82, 12, 74, 72, 88, 43, 60, 84
           dd 18, 18, 76, 98, 60, 75, 75, 5, 59, 38
           dd 60, 33, 91, 15, 36, 47, 75, 36, 9, 69
           dd 68, 11, 31, 87, 48, 63, 95, 38, 31, 5
           dd 68, 17, 88, 17, 82, 40, 98, 19, 70, 21
           dd 26, 94, 28, 63, 59, 26, 9, 22, 23, 26
           dd 7, 37, 78, 8, 27, 9, 64, 6, 27, 94
           dd 35, 27, 68, 5, 41, 37, 19, 10, 14, 97
           dd 41, 24, 50, 6, 58, 48, 87, 94, 93, 26
           dd 20, 39, 72, 29, 4, 65, 40, 46, 75, 53
           dd 22, 86, 82, 12, 74, 72, 88, 43, 60, 84
           dd 18, 18, 76, 98, 60, 75, 75, 5, 59, 38
           dd 60, 33, 91, 15, 36, 47, 75, 36, 9, 69
           dd 68, 11, 31, 87, 48, 63, 95, 38, 31, 5
           dd 68, 17, 88, 17, 82, 40, 98, 19, 70, 21
           dd 26, 94, 28, 63, 59, 26, 9, 22, 23, 26
           dd 7, 37, 78, 8, 27, 9, 64, 6, 27, 94
           dd 35, 27, 68, 5, 41, 37, 19, 10, 14, 97
           dd 41, 24, 50, 6, 58, 48, 87, 94, 93, 26
           dd 20, 39, 72, 29, 4, 65, 40, 46, 75, 53
           dd 22, 86, 82, 12, 74, 72, 88, 43, 60, 84
           dd 18, 18, 76, 98, 60, 75, 75, 5, 59, 38
           dd 60, 33, 91, 15, 36, 47, 75, 36, 9, 69
           dd 68, 11, 31, 87, 48, 63, 95, 38, 31, 5
           dd 68, 17, 88, 17, 82, 40, 98, 19, 70, 21
           dd 26, 94, 28, 63, 59, 26, 9, 22, 23, 26
           dd 7, 37, 78, 8, 27, 9, 64, 6, 27, 94
           dd 35, 27, 68, 5, 41, 37, 19, 10, 14, 97
           dd 41, 24, 50, 6, 58, 48, 87, 94, 93, 26
           dd 20, 39, 72, 29, 4, 65, 40, 46, 75, 53
           dd 22, 86, 82, 12, 74, 72, 88, 43, 60, 84
           dd 18, 18, 76, 98, 60, 75, 75, 5, 59, 38
           dd 60, 33, 91, 15, 36, 47, 75, 36, 9, 69
           dd 68, 11, 31, 87, 48, 63, 95, 38, 31, 5
           dd 68, 17, 88, 17, 82, 40, 98, 19, 70, 21
           dd 26, 94, 28, 63, 59, 26, 9, 22, 23, 26
           dd 7, 37, 78, 8, 27, 9, 64, 6, 27, 94
           dd 35, 27, 68, 5, 41, 37, 19, 10, 14, 97
           dd 41, 24, 50, 6, 58, 48, 87, 94, 93, 26
           dd 20, 39, 72, 29, 4, 65, 40, 46, 75, 53
           dd 22, 86, 82, 12, 74, 72, 88, 43, 60, 84
           dd 18, 18, 76, 98, 60, 75, 75, 5, 59, 38
           dd 60, 33, 91, 15, 36, 47, 75, 36, 9, 69
           dd 68, 11, 31, 87, 48, 63, 95, 38, 31, 5
           dd 68, 17, 88, 17, 82, 40, 98, 19, 70, 21
           dd 26, 94, 28, 63, 59, 26, 9, 22, 23, 26
           dd 7, 37, 78, 8, 27, 9, 64, 6, 27, 94
           dd 35, 27, 68, 5, 41, 37, 19, 10, 14, 97
           dd 41, 24, 50, 6, 58, 48, 87, 94, 93, 26
           dd 20, 39, 72, 29, 4, 65, 40, 46, 75, 53
           dd 22, 86, 82, 12, 74, 72, 88, 43, 60, 84
           dd 18, 18, 76, 98, 60, 75, 75, 5, 59, 38
           dd 60, 33, 91, 15, 36, 47, 75, 36, 9, 69
           dd 68, 11, 31, 87, 48, 63, 95, 38, 31, 5
           dd 68, 17, 88, 17, 82, 40, 98, 19, 70, 21
           dd 26, 94, 28, 63, 59, 26, 9, 22, 23, 26
           dd 7, 37, 78, 8, 27, 9, 64, 6, 27, 94
           dd 35, 27, 68, 5, 41, 37, 19, 10, 14, 97
           dd 41, 24, 50, 6, 58, 48, 87, 94, 93, 26
           dd 20, 39, 72, 29, 4, 65, 40, 46, 75, 53
           dd 22, 86, 82, 12, 74, 72, 88, 43, 60, 84
           dd 18, 18, 76, 98, 60, 75, 75, 5, 59, 38
           dd 60, 33, 91, 15, 36, 47, 75, 36, 9, 69
           dd 68, 11, 31, 87, 48, 63, 95, 38, 31, 5
           dd 68, 17, 88, 17, 82, 40, 98, 19, 70, 21
           dd 26, 94, 28, 63, 59, 26, 9, 22, 23, 26
           dd 7, 37, 78, 8, 27, 9, 64, 6, 27, 94
           dd 35, 27, 68, 5, 41, 37, 19, 10, 14, 97
           dd 41, 24, 50, 6, 58, 48, 87, 94, 93, 26
           dd 20, 39, 72, 29, 4, 65, 40, 46, 75, 53
           dd 22, 86, 82, 12, 74, 72, 88, 43, 60, 84
           dd 18, 18, 76, 98, 60, 75, 75, 5, 59, 38
           dd 60, 33, 91, 15, 36, 47, 75, 36, 9, 69
           dd 68, 11, 31, 87, 48, 63, 95, 38, 31, 5
           dd 68, 17, 88, 17, 82, 40, 98, 19, 70, 21
           dd 26, 94, 28, 63, 59, 26, 9, 22, 23, 26
           dd 7, 37, 78, 8, 27, 9, 64, 6, 27, 94
           dd 35, 27, 68, 5, 41, 37, 19, 10, 14, 97
           dd 41, 24, 50, 6, 58, 48, 87, 94, 93, 26
           dd 20, 39, 72, 29, 4, 65, 40, 46, 75, 53
           dd 22, 86, 82, 12, 74, 72, 88, 43, 60, 84
           dd 18, 18, 76, 98, 60, 75, 75, 5, 59, 38
           dd 60, 33, 91, 15, 36, 47, 75, 36, 9, 69
           dd 68, 11, 31, 87, 48, 63, 95, 38, 31, 5
           dd 68, 17, 88, 17, 82, 40, 98, 19, 70, 21
           dd 26, 94, 28, 63, 59, 26, 9, 22, 23, 26
           dd 7, 37, 78, 8, 27, 9, 64, 6, 27, 94
           dd 35, 27, 68, 5, 41, 37, 19, 10, 14, 97

    array_len equ 100

section .bss
    tv_start resd 2      ; struct timeval { long tv_sec, tv_usec }
    tv_end   resd 2
    result_str resb 16

section .text
    global _start

_start:
    ; syscall gettimeofday(&tv_start, NULL)
    mov eax, 78
    mov ebx, tv_start
    mov ecx, 0
    int 0x80

    ; bubble sort
    mov ecx, array_len
.outer:
    dec ecx
    xor esi, esi
.inner:
    mov eax, [array + esi*4]
    mov ebx, [array + esi*4 + 4]
    cmp eax, ebx
    jle .noswap
    mov [array + esi*4], ebx
    mov [array + esi*4 + 4], eax
.noswap:
    inc esi
    cmp esi, ecx
    jl .inner
    test ecx, ecx
    jnz .outer

    ; syscall gettimeofday(&tv_end, NULL)
    mov eax, 78
    mov ebx, tv_end
    mov ecx, 0
    int 0x80

    ; calculate microsecond difference
    mov eax, [tv_end]
    sub eax, [tv_start]
    mov ebx, 1000000
    mul ebx
    mov ecx, eax
    mov eax, [tv_end+4]
    sub eax, [tv_start+4]
    add ecx, eax

    ; convert to string (ECX)
    mov edi, result_str + 15
    mov byte [edi], 0
    mov eax, ecx
.convert:
    xor edx, edx
    mov ebx, 10
    div ebx
    add dl, '0'
    dec edi
    mov [edi], dl
    test eax, eax
    jnz .convert

    ; print message
    mov eax, 4
    mov ebx, 1
    mov ecx, msg
    mov edx, msg_len
    int 0x80

    ; print number
    mov eax, 4
    mov ebx, 1
    mov ecx, edi
    mov edx, result_str + 15
    sub edx, edi
    int 0x80

    ; newline
    mov eax, 4
    mov ebx, 1
    mov ecx, newline
    mov edx, 1
    int 0x80

    ; exit
    mov eax, 1
    xor ebx, ebx
    int 0x80
